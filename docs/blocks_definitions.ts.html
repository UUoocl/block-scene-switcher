<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: blocks/definitions.ts</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: blocks/definitions.ts</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file definitions.ts
 * @description Defines custom Blockly blocks for OBS control, Broadcast Channel API, and Server-Sent Events.
 * 
 * COMMENTARY: Custom blocks are defined using both the JavaScript object approach 
 * (for complex dynamic blocks like dropdowns) and the JSON array approach 
 * (for simpler static blocks). This flexibility allows for rich UI elements 
 * while maintaining ease of definition for standard blocks.
 */

import * as Blockly from 'blockly';

/**
 * Stores the list of scenes retrieved from OBS.
 * Used to populate the scene selection dropdown in blocks.
 */
export let sceneOptions: [string, string][] = [['Connect to OBS...', 'none']];

/**
 * Updates the sceneOptions array with a new list of scenes.
 * @param scenes - Array of scene objects from OBS.
 */
export function setSceneOptions(scenes: { sceneName: string }[]) {
  if (scenes.length > 0) {
    sceneOptions = scenes.map(s => [s.sceneName, s.sceneName]);
  } else {
    sceneOptions = [['No scenes found', 'none']];
  }
}

/**
 * Defines custom OBS and API blocks for Blockly.
 */
export const defineObsBlocks = () => {
  // ... (Existing Dropdown Block) ...
  Blockly.Blocks['obs_request_set_scene'] = {
    init: function(this: Blockly.Block) {
      this.appendDummyInput()
          .appendField("Switch to Scene")
          .appendField(new Blockly.FieldDropdown(() => sceneOptions), "SCENE");
      this.setPreviousStatement(true, null);
      this.setNextStatement(true, null);
      this.setColour(160);
      this.setTooltip("Sets the current program scene");
    }
  };

  Blockly.defineBlocksWithJsonArray([
    // --- EXISTING EVENTS ---
    {
      "type": "obs_event_scene_changed",
      "message0": "When Scene Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230,
      "tooltip": "Triggers when the program scene changes."
    },
    {
      "type": "obs_event_mute_changed",
      "message0": "When Mute State Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_stream_state",
      "message0": "When Stream State Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_input_settings_changed",
      "message0": "When Input Settings Change %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_custom",
      "message0": "When Custom Event %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_input_active_state_changed",
      "message0": "When Input Active State Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_input_show_state_changed",
      "message0": "When Input Show State Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_scene_item_enable_state_changed",
      "message0": "When Item Enable State Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },
    {
      "type": "obs_event_scene_item_lock_state_changed",
      "message0": "When Item Lock State Changes %1 %2",
      "args0": [{ "type": "input_dummy" }, { "type": "input_statement", "name": "DO" }],
      "colour": 230
    },

    // --- REQUESTS ---
    {
      "type": "obs_request_set_mute",
      "message0": "Set Mute for %1 to %2",
      "args0": [
        { "type": "field_input", "name": "INPUT", "text": "Mic/Aux" },
        { "type": "field_checkbox", "name": "MUTE", "checked": true }
      ],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 160
    },
    {
      "type": "obs_request_control_stream",
      "message0": "%1 Streaming",
      "args0": [{
        "type": "field_dropdown",
        "name": "ACTION",
        "options": [["Start", "StartStream"], ["Stop", "StopStream"], ["Toggle", "ToggleStream"]]
      }],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 160
    },
    // NEW BLOCK: Set Input Settings
    {
      "type": "obs_request_set_input_settings",
      "message0": "Set Settings for %1 to %2 Overlay %3",
      "args0": [
        { "type": "field_input", "name": "INPUT", "text": "Source Name" },
        { "type": "input_value", "name": "SETTINGS", "check": "String" },
        { "type": "field_checkbox", "name": "OVERLAY", "checked": true }
      ],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 160,
      "tooltip": "Sets input settings. 'Settings' must be a JSON string. Overlay=True merges settings, False resets defaults."
    },
    // NEW BLOCK: Console Log
    {
      "type": "custom_console_log",
      "message0": "console.log %1",
      "args0": [
        {
          "type": "input_value",
          "name": "LOG_DATA"
        }
      ],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 160,
      "tooltip": "Logs the input value to the browser console.",
      "helpUrl": ""
    },
    // --- BROADCAST CHANNEL API ---
    {
      "type": "broadcast_send",
      "message0": "Send Broadcast to %1 message %2",
      "args0": [
        { "type": "field_input", "name": "CHANNEL", "text": "channel_name" },
        { "type": "input_value", "name": "MESSAGE" }
      ],
      "previousStatement": null,
      "nextStatement": null,
      "colour": 200,
      "tooltip": "Sends a message to the specified broadcast channel."
    },
    {
      "type": "broadcast_receive",
      "message0": "When message received on %1 %2 %3",
      "args0": [
        { "type": "field_input", "name": "CHANNEL", "text": "channel_name" },
        { "type": "input_dummy" },
        { "type": "input_statement", "name": "DO" }
      ],
      "colour": 200,
      "tooltip": "Triggers when a message is received on the specified broadcast channel."
    },
    {
      "type": "broadcast_message_object",
      "message0": "received broadcast message",
      "output": null,
      "colour": 200,
      "tooltip": "The message object received from the broadcast channel."
    },
    // --- SERVER SENT EVENTS (SSE) ---
    {
      "type": "sse_listen",
      "message0": "When SSE from %1 event %2 %3 %4",
      "args0": [
        { "type": "field_input", "name": "URL", "text": "http://localhost:8000/sse" },
        { "type": "field_input", "name": "EVENT", "text": "" },
        { "type": "input_dummy" },
        { "type": "input_statement", "name": "DO" }
      ],
      "colour": 210,
      "tooltip": "Listens for Server-Sent Events from the specified URL. Leave 'event' empty for default messages."
    },
    {
      "type": "sse_message_object",
      "message0": "SSE message",
      "output": null,
      "colour": 210,
      "tooltip": "The message data received from the SSE connection."
    }
  ]);
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#connectOBS">connectOBS</a></li><li><a href="global.html#defineObsBlocks">defineObsBlocks</a></li><li><a href="global.html#ensureGlobalObsWss">ensureGlobalObsWss</a></li><li><a href="global.html#fetchApiDetails">fetchApiDetails</a></li><li><a href="global.html#fetchLocalList">fetchLocalList</a></li><li><a href="global.html#fetchObsidianList">fetchObsidianList</a></li><li><a href="global.html#forceStopDeployment">forceStopDeployment</a></li><li><a href="global.html#getCssVariableDetails">getCssVariableDetails</a></li><li><a href="global.html#getLocalStorageDetails">getLocalStorageDetails</a></li><li><a href="global.html#getUrlParamDetails">getUrlParamDetails</a></li><li><a href="global.html#initDeployHandlers">initDeployHandlers</a></li><li><a href="global.html#initFileHandlers">initFileHandlers</a></li><li><a href="global.html#initLoadModal">initLoadModal</a></li><li><a href="global.html#initObsGenerators">initObsGenerators</a></li><li><a href="global.html#initSaveModal">initSaveModal</a></li><li><a href="global.html#loadAndInject">loadAndInject</a></li><li><a href="global.html#loadFromLocal">loadFromLocal</a></li><li><a href="global.html#loadFromObsidian">loadFromObsidian</a></li><li><a href="global.html#manageObsConnection">manageObsConnection</a></li><li><a href="global.html#refreshFileList">refreshFileList</a></li><li><a href="global.html#saveToLocal">saveToLocal</a></li><li><a href="global.html#saveToObsidian">saveToObsidian</a></li><li><a href="global.html#sceneOptions">sceneOptions</a></li><li><a href="global.html#setSceneOptions">setSceneOptions</a></li><li><a href="global.html#setupEventListeners">setupEventListeners</a></li><li><a href="global.html#showConnectionModal">showConnectionModal</a></li><li><a href="global.html#stopDeployment">stopDeployment</a></li><li><a href="global.html#triggerDeployment">triggerDeployment</a></li><li><a href="global.html#updateButtonStyle">updateButtonStyle</a></li><li><a href="global.html#workspace">workspace</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Jan 05 2026 13:10:21 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
